<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>+ Artı Beklenen Item Sayısı</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; padding: 30px; }
    h2 { color: #333; }
    .level { margin-bottom: 10px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; }
    label { min-width: 140px; }
    input[type=number] { width: 60px; padding: 3px; }
    select { padding: 3px; }
    button { padding: 8px 15px; background: #4CAF50; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
    button:hover { background: #45a049; }
    #result { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-top: 20px; }
    #tableContainer { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-top: 20px; }
</style>
</head>
<body>

<h2>+ Artı Beklenen Item Sayısı (+0 → +9)</h2>

Başlangıç +: <input type="number" id="startPlus" value="5" min="0" max="9">
Hedef +: <input type="number" id="endPlus" value="9" min="1" max="9">
Item sayısı: <input type="number" id="items" value="100" min="1"><br><br>

<div id="levels"></div>

<button onclick="calculate()">Hesapla</button>

<h3>Sonuç:</h3>
<pre id="result"></pre>

<div id="tableContainer">
    <canvas id="itemChart" width="300" height="100"></canvas>
</div>

<script>
const maxLevel = 9;
const default_probs = [1.00,0.80,0.70,0.60,0.50,0.25,0.20,0.18,0.10]; // +0->+1 … +8->+9

const levelsDiv = document.getElementById("levels");
const prob_inputs = [];
const bonus_inputs = [];

for(let i=0;i<maxLevel;i++){
    const div = document.createElement("div");
    div.className="level";
    const label = document.createElement("label");
    label.innerText=`+${i} → +${i+1} olasılık (%)`;
    const probInput=document.createElement("input");
    probInput.type="number";
    probInput.value=(default_probs[i]*100).toFixed(0);
    probInput.min=0; probInput.max=100;
    const bonusSelect=document.createElement("select");
    bonusSelect.innerHTML=`<option value="0">Bonus Yok</option><option value="0.05">+5%</option><option value="0.10">+10%</option>`;
    div.appendChild(label);
    div.appendChild(probInput);
    div.appendChild(bonusSelect);
    levelsDiv.appendChild(div);
    prob_inputs.push(probInput);
    bonus_inputs.push(bonusSelect);
}

let chart;

function calculate(){
    const startPlus=parseInt(document.getElementById("startPlus").value);
    const endPlus=parseInt(document.getElementById("endPlus").value);
    const items=parseInt(document.getElementById("items").value);

    if(endPlus<=startPlus){ alert("Hedef + değeri başlangıç + değerinden büyük olmalı!"); return; }

    let remainingItems = items;
    const counts = [];
    const labels = [];

    for(let i=startPlus;i<=endPlus;i++){
        labels.push(`+${i}`);
        if(i===startPlus){
            counts.push(remainingItems); 
        } else {
            let prob=parseFloat(prob_inputs[i-1].value)/100 + parseFloat(bonus_inputs[i-1].value);
            if(prob>1) prob=1;
            remainingItems *= prob;
            counts.push(remainingItems);
        }
    }

    document.getElementById("result").textContent = 
`Başlangıç item sayısı: ${items}
+${startPlus} → +${endPlus} arası beklenen item sayıları:
${labels.map((l,i)=>`${l}: ${counts[i].toFixed(2)}`).join('\n')}`;

    
    const ctx=document.getElementById("itemChart").getContext("2d");
    if(chart) chart.destroy();
    chart = new Chart(ctx,{
        type:'line',
        data:{
            labels:labels,
            datasets:[{
                label:'Beklenen Item Sayısı',
                data:counts.map(x=>x.toFixed(2)),
                backgroundColor:'rgba(54, 162, 235, 0.6)',
                borderColor:'rgba(54, 162, 235, 1)',
                borderWidth:1
            }]
        },
        options:{
            scales:{
                y:{ beginAtZero:true }
            }
        }
    });
}
</script>

</body>
</html>